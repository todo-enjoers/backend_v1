# Техническое задание

## Ежедневник в формате "TO DO"

---

### Общие требования

Система представляет собой HTTP API со следующими требованиями к бизнес-логике:

* регистрация, аутентификация и авторизация пользователей;
* создание проектов, получение всех проектов, получение определенного проекта, его изменение и удаление;
* создание колонок, получение всех колонок, получение определенной колонки, её изменение и удаление;
* создание заметок, получение всех заметок, получение определенной заметки, её изменение и удаление.

### Абстрактная схема взаимодействия с системой

Ниже представлена абстрактная бизнес-логика взаимодействия пользователя с системой:

1. Пользователь регистрируется/авторизируется в системе.
2. Пользователь создает проект/проекты.
3. Пользователь создает колонки/колонки.
4. Пользователь создает заметку/заметки.

### Сводное HTTP API

Система работы с пользователем должна предоставлять следующие HTTP-хендлеры:

* `POST /api/users/register` — регистрация пользователя;
* `POST /api/users/login` — аутентификация пользователя;
* `GET /api/users/me` — получение профиля аутентифицированного пользователя;
* `GET /api/users/all` — получение списка пользователей;
* `PUT /api/users/change-password` — изменение пароля пользователя;
* `POST /api/users/refresh-token` — подписание рефреш токена;

Система работы с проектами должна предоставлять следующие HTTP-хендлеры:

* `POST /api/projects/create/` - создание нового проекта
* `DELETE /api/projects/delete/:id` - удаление проекта по id
* `PUT /api/projects/update/:id` - изменение проекта по id
* `GET /api/projects/` - получение всех проектов
* `GET /api/projects/:id` - удаление проекта по id

Система работы с колнками должна предоставлять следующие HTTP-хендлеры:

* `POST /api/columns/` - создание колонки
* `DELETE /api/columns/:id/:name` - удаление колонки по ID проекта и по имении колонки
* `PUT /api/columns/:id/:name` - изменение колонки по ID проекта и по имени колонки
* `GET /api/columns/:id/:name` - получение колонки по ID проекта и по имени колонки
* `GET /api/columns/:id/` - получение всех колонок по ID проекта

Система работы с записями должна предоставлять следующие HTTP-хендлеры:

* `GET /api/todos/` - получение всех заметок
* `GET /api/todos/:id` - получение заметки по id
* `POST /api/todos/` - создание новой заметки
* `PUT /api/todos/:id` - изменение заметки по id
* `DELETE /api/todos/:id` - удаление заметки по id

#### Регистрация пользователя

Хендлер: `POST /api/users/register`.

Регистрация производится по паре логин/пароль. Каждый логин должен быть уникальным.

После успешной регистрации должна происходить автоматическая аутентификация пользователя.

Формат запроса:

```
POST /api/users/register HTTP/1.1
Content-Type: application/json
...

{
  "login": "<login>",
  "password": "<password>"
}
```

Возможные коды ответа:

- `201` — пользователь успешно зарегистрирован и аутентифицирован;

  Формат ответа:

    ```
    201 CREATED HTTP/1.1
    Content-Type: application/json
    ...
    
    {
      "id": "<id>",
      "access_token": "<access_token>",
      "refresh_token": "<refresh_token>"
    }
    ```
  
- `400` — неверный формат запроса;
- `409` — логин уже занят;
- `500` — внутренняя ошибка сервера.

#### Аутентификация пользователя

Хендлер: `POST /api/user/login`.

Аутентификация производится по паре логин/пароль.

Формат запроса:

```
POST /api/users/login HTTP/1.1
Content-Type: application/json
...

{
  "login": "<login>",
  "password": "<password>"
}
```

Возможные коды ответа:

- `200` — пользователь успешно аутентифицирован;
  Формат ответа:

    ```
    200 OK HTTP/1.1
    Content-Type: application/json
    ...
    
    {
      "id": "<id>",
      "access_token": "<access_token>",
      "refresh_token": "<refresh_token>"
    }
    ```
  
- `400` — неверный формат запроса;
- `401` — неверная пара логин/пароль;
- `500` — внутренняя ошибка сервера.

#### Изменение пароля пользователя

Хендлер: `PUT /api/users/change-password`.

Формат запроса:

```
PUT /api/users/change-password HTTP/1.1
Content-Type: application/json
...

{
  "old_password": "<old_password>"
  "new_password": "<new_password>"
  "new_password_again": "<new_password_again>"
}
```

Возможные коды ответа:

- `200` — пользователь успешно аутентифицирован;
- `204` — нет данных для ответа.
- `400` — неверный формат запроса;
- `401` — пользователь не авторизован;
- `406` - несоответствие нового пароля, повторному новому паролю;
- `500` — внутренняя ошибка сервера.

#### Получение профиля аутентифицированного пользователя

Хендлер: `GET /api/users/me`.

Хендлер доступен только аутентифицированным пользователям.

Формат запроса:

```
GET /api/users/me HTTP/1.1
Content-Length: 0
...
```

Возможные коды ответа:

- `200` — успешная обработка запроса.

  Формат ответа:

    ```
    200 OK HTTP/1.1
    Content-Type: application/json
    ...

    {
      "id": "<id>",
      "login": "<login>"
    }
    ```
  
- `204` — нет данных для ответа.
- `401` — пользователь не авторизован.
- `500` — внутренняя ошибка сервера.

#### Получение списка аутентифицированных пользователей

Хендлер: `GET /api/users/all`.

Хендлер доступен только аутентифицированным пользователю. 

Формат запроса:

```
GET /api/user/orders HTTP/1.1
Content-Length: 0
```

Возможные коды ответа:

- `200` — успешная обработка запроса.

  Формат ответа:
    ```    
    200 OK HTTP/1.1
    Content-Type: application/json
    ...

    [
      {
        "id": "<id>",
        "login": "<login>"
      },
      {
        "id": "<id>",
        "login": "<login>"
      },
      {
        "id": "<id>",
        "login": "<login>"
      }
    ]
    ```

- `204` — нет данных для ответа.
- `401` — пользователь не авторизован.
- `500` — внутренняя ошибка сервера.
          
#### Генерация новой пары ключей
Хендлер: `POST /api/users/refresh-token`.

Хендлер доступен только аутентифицированным пользователю.

Формат запроса:

```
POST /api/users/refresh-token
Content-Type: application/json
...

{
  "id": "<id>",
  "refresh_token": "<refresh_token>",
}
```

Возможные коды ответа:

- `201` — пара токенов успешно создана.

  Формат ответа:
    ```    
    201 CREATED HTTP/1.1
    Content-Type: application/json
    ...

    
    {
      "id": "<id>",
      "access_token": "<access_token>",
      "refresh_token": "<refresh_token>"
    }
    ```

- `401` — пользователь не авторизован.
- `500` — внутренняя ошибка сервера.

### Конфигурирование сервиса накопительной системы лояльности

Сервис должн поддерживать конфигурирование следующими методами:

- адрес и порт запуска сервиса: переменная окружения ОС RUN_ADDRESS или флаг -a
- адрес подключения к базе данных: переменная окружения ОС DATABASE_URI или флаг -d
- адрес системы расчёта начислений: переменная окружения ОС ACCRUAL_SYSTEM_ADDRESS или флаг -r


### Получение всех заметок

Хэндлер: GET /api/todos/

Доступно только для авторизованных пользователей

Формат запроса:

```
GET /api/todos/ HTTP/1.1
Content-Length: 0
```

Возможные коды ответа:

- `200` — успешная обработка запроса.

  Формат ответа:
    ```    
    200 OK HTTP/1.1
    Content-Type: application/json
    ...

    [
      {
        "id": "<id>"
		"name": "<name>"
		"description": "<description>",
		"is_completed": "<is_complited>",
		"project_id": "<project_id>",
		"created_by": "<created_by>",
		"column": "<column>"
      },
      {
        "id": "<id>"
		"name": "<name>"
		"description": "<description>",
		"is_completed": "<is_complited>",
		"project_id": "<project_id>",
		"created_by": "<created_by>",
		"column": "<column>"
      },
      {
        "id": "<id>"
		"name": "<name>"
		"description": "<description>",
		"is_completed": "<is_complited>",
		"project_id": "<project_id>",
		"created_by": "<created_by>",
		"column": "<column>"
      }
    ]
    ```

- `204` — нет данных для ответа.
- `400` — метод не поддерживается
- `401` — пользователь не авторизован.


### Создание заметки

Хэндлер POST /api/todos/

Доступно только для авторизованных пользователей

Формат запроса:

```
POST /api/todos/ HTTP/1.1
Content-Type: application/json

{
        "id": "<id>",
        "name": "<name>",
	"description": "<description>",
	"is_completed": "<is_complited>",
	"project_id": "<project_id>",
	"created_by": "<created_by>",
	"column": "<column>"
}
```

Возможные коды ответа:

- `201` — успешное создание

Формат ответа:

```
{
201 OK HTTP/1.1
Content-Type: application/json

        "id": "<id>",
        "name": "<name>",
	"description": "<description>",
	"is_completed": "<is_complited>",
	"project_id": "<project_id>",
	"created_by": "<created_by>",
	"column": "<column>"
}
```
- `400` — метод не поддерживается
- `401` — не авторизован
- `409` — ошибки с бд

### Получение заметки по ID 

Хэндлер GET /api/todos/:id

Доступно только для авторизованных пользователей

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится 

Формат запроса: 

```
GET /api/todos/:id
Content-Length: 0
```

Возможные коды ответа:

- `200` — успешная обработка запроса

Формат ответа:

```
{
200 OK HTTP/1.1
Content-Type: application/json

        "id": "<id>",
        "name": "<name>",
	"description": "<description>",
	"is_completed": "<is_complited>",
	"project_id": "<project_id>",
	"created_by": "<created_by>",
	"column": "<column>"
}
```
- `400` — метод не поддерживается 
- `401` — пользователь не авторизован
- `404` — не найден ресурс

### Изменение заметки по ID

Хэндлер PUT /api/todos/:id

Доступно только для авторизованных пользователей

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится 

Формат запроса:

```
PUT /api/todos/:id HTTP/1.1
Content-Type: application/json

{
        "id": "<id>",
        "name": "<name>",
	"description": "<description>",
	"is_completed": "<is_complited>",
	"project_id": "<project_id>",
	"created_by": "<created_by>",
	"column": "<column>"
}
```

Возможные коды ответа:

- `201` — успешное создание

Формат ответа:

```
{
201 OK HTTP/1.1
Content-Type: application/json

        "id": "<id>",
        "name": "<name>",
	"description": "<description>",
	"is_completed": "<is_complited>",
	"project_id": "<project_id>",
	"created_by": "<created_by>",
	"column": "<column>"
}
```
- `400` — метод не поддерживается
- `401` — не авторизован
- `404` — не существует ресурса
- `500` — ошибки сервера

### Удаление заметки по ID

Хэндлер DELETE /api/todos/:id

Доступно только для авторизованных пользователей

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится

Формат запроса:
```
DELETE /api/todos/:id HTTP/1.1
Content-Length: 0
```
Формат ответа:

- `204` — нет контента, успешно удалено
- `400` — метод не поддерживается
- `401` — не авторизован
- `404` — не существует ресурса
- `500` — ошибки сервера

### Создание колонки

Хэндлер POST /api/columns/

Доступно только для авторизованных пользователей

Формат запроса:

```
POST /api/columns/ HTTP/1.1
Content-Type: application/json

{
        "project_id": "<id>",
        "name": "<name>",
	"order": "<order>"
}
```

Возможные коды ответа:

- `201` — успешное создание

Формат ответа:

```
201 OK HTTP/1.1
Content-Type: application/json

{       "project_id": "<id>",
        "name": "<name>",
	"order": "<order>"
}
```

- `400` — метод не поддерживается
- `401` — не авторизован
- `409` — ошибки с бд

### Удаление колонки по ID проекта и по имении колонки

Хэндлер DELETE /api/columns/:id/:name

Доступно только для авторизованных пользователей

:id, :name — динамически изменяющиеся параметры, от которых зависит результат запроса, они указываются в эндпоинте и далее парсятся

Формат запроса:
```
DELETE /api/columns/:id/:name HTTP/1.1
Content-Length: 0
```
Формат ответа:

- `204` — нет контента, успешно удалено
- `400` — метод не поддерживается
- `401` — не авторизован
- `500` — ошибки сервера

### Изменение колонки по ID проекта и по имении колонки

Хэндлер PUT /api/columns/:id/:name

Доступно только для авторизованных пользователей

:id, :name — динамически изменяющиеся параметры, от которых зависит результат запроса, они указываются в эндпоинте и далее парсятся

Формат запроса:

```
PUT /api/columns/:id/:name HTTP/1.1
Content-Type: application/json

{
        "project_id": "<id>",
        "name": "<name>",
	"order": "<order>"
}
```

Возможные коды ответа:

- `201` — успешное создание

Формат ответа:

```
201 OK HTTP/1.1
Content-Type: application/json

{       "project_id": "<id>",
        "name": "<name>",
	"order": "<order>"
}
```

- `400` — метод не поддерживается
- `401` — не авторизован
- `409` — ошибки с бд
- `404` — не найден
- `500` — ошибки сервера

### Получение колонки по ID проекта и по имении колонки

Хэндлер GET /api/columns/:id/:name

Доступно только для авторизованных пользователей

:id, :name — динамически изменяющиеся параметры, от которых зависит результат запроса, они указываются в эндпоинте и далее парсятся

Формат запроса:

```
GET /api/columns/:id/:name
Content-Length: 0
```

Возможные коды ответа:

- `200` — успешная обработка запроса

Формат ответа:

```
200 OK HTTP/1.1
Content-Type: application/json

{       "project_id": "<id>",
        "name": "<name>",
	"order": "<order>"
}
```

- `400` — метод не поддерживается
- `401` — пользователь не авторизован
- `404` — не найден ресурс

### Получение всех колонок по ID проекта

Хэндлер GET /api/columns/:id/

Доступно только для авторизованных пользователей

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится

Формат запроса:

```
GET /api/columns/:id/
Content-Length: 0
```

Возможные коды ответа:

- `200` — успешная обработка запроса

Формат ответа:
```    
200 OK HTTP/1.1
Content-Type: application/json
...

    [
      {       "project_id": "<id>",
              "name": "<name>",
	      "order": "<order>"
      },
      {       "project_id": "<id>",
              "name": "<name>",
	      "order": "<order>"
      },
      {       "project_id": "<id>",
              "name": "<name>",
	      "order": "<order>"
      }
    ]
```
    
- `400` — метод не поддерживается
- `401` — пользователь не авторизован
- `204` — нет контента

### Создание нового проекта

Хэндлер POST /api/projects/create/

Доступно только для авторизованных пользователей

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится

Формат запроса:

```
POST /api/projects/create/
Content-Type: application/json
....
{
    "id": "<id>",
    "name": "<name>",
    "created_by": "<created_by>"
}
```
Возможные коды ответа:

- `201` — успешная создание ресурса

Формат ответа:

```
201 OK HTTP/1.1
Content-Type: application/json
....
{
    "id": "<id>",
    "name": "<name>",
    "created_by": "<created_by>"
}
```
- `400` — метод не поддерживается
- `401` — пользователь не авторизован
- `409` — ошибки с бд

### Удаление проекта по ID

Хэндлер DELETE /api/projects/delete/:id

Доступно только для авторизованных пользователей

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится

Формат запроса:
```
DELETE /api/projects/delete/:id HTTP/1.1
Content-Length: 0
```
Формат ответа:

- `204` — нет контента, успешно удалено
- `400` — метод не поддерживается
- `401` — не авторизован
- `500` — ошибки сервера
- `404` — не найден

### Изменение проекта по ID 

Хэндлер PUT /api/projects/update/delete/:id

Доступно только для авторизованных пользователей

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится

Формат запроса:

```
PUT /api/columns/:id/:name HTTP/1.1
Content-Type: application/json

{
    "id": "<id>",
    "name": "<name>",
    "created_by": "<created_by>"
}
```

Возможные коды ответа:

- `201` — успешное создание

Формат ответа:

```
201 OK HTTP/1.1
Content-Type: application/json

{
    "id": "<id>",
    "name": "<name>",
    "created_by": "<created_by>"
}
```
- `400` — метод не поддерживается
- `401` — не авторизован
- `409` — ошибки с бд
- `404` — не найден
- `500` — ошибки сервера

### Получение всех проектов

Хэндлер GET /api/projects/

Доступно только для авторизованных пользователей

Формат запроса:

```
GET /api/projects/
Content-Length: 0
```

Возможные коды ответа:

- `200` — успешная обработка запроса

Формат ответа:
```    
200 OK HTTP/1.1
Content-Type: application/json
...

    [
      {
        "id": "<id>",
        "name": "<name>",
        "created_by": "<created_by>"
      },
      {
        "id": "<id>",
        "name": "<name>",
        "created_by": "<created_by>",
      },
      {
        "id": "<id>",
        "name": "<name>",
        "created_by": "<created_by>"
      }
    ]
```
- `401` — не авторизован
- `204` — нет данных для ответа

### Получение проекта по ID

Хэндлер GET /api/projects/:id

:id — динамически изменяющийся параметр, от которого зависит результат запроса, он указывается в эндпоинте и далее парсится

Доступно только для авторизованных пользователей

Формат запроса:

```
GET /api/projects/:id
Content-Length: 0
```

Возможные коды ответа:

- `200` — успешная обработка запроса

Формат ответа:

```
201 OK HTTP/1.1
Content-Type: application/json

{
"id": "<id>",
"name": "<name>",
"created_by": "<created_by>"
},
```
- `400` — метод не поддерживается
- `401` — не авторизован
- `404` — не найден



